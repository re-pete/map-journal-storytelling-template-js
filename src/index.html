<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
        
        <meta name="fragment" content="!">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
        
        <link type="image/ico" rel="shortcut icon" href="//resources.esri.com/favicon.ico">
        <link type="image/ico" rel="icon"  href="//resources.esri.com/favicon.ico">
        
        <!-- 
            To correctly reference your Map Journal in search engine:
             - create and fill out extensively an ArcGIS Online item that link to your final application
             - edit the following four tags as well as the title tag above on line 4
        -->
        <meta name="description" content="This story map was created with the Story Map Journal application in ArcGIS Online.">
        
        <!-- Facebook sharing -->
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Story Map Journal"/>
        <meta property="og:description" content="This story map was created with the Story Map Journal application in ArcGIS Online."/>
        <meta property="og:image" content="http://www.arcgis.com/apps/MapJournal/resources/common/icons/esri-globe.png"/>
        
        <!-- 
            This application is released under the Apache License V2.0 by Esri http://www.esri.com/
            Checkout the project repository on GitHub to access source code, latest revision, developer documentation, FAQ and tips
            https://github.com/Esri/map-journal-storytelling-template-js
        -->
        <script type="text/javascript" src="config/defaults.js"></script>   
        
        <!--
        
            Edit below at your own risk
        
        -->
        
        <script type="text/javascript">
            var app = {
                version: '1.4.1',
                pathJSAPI: '//js.arcgis.com/3.14/'
            };
        </script>
    <!-- Loading -->
    <style>
        #loadingOverlay {
            position: absolute; 
            top: 0; 
            left: 0; 
            z-index: 1100; 
            width: 100%; 
            height: 100%; 
            overflow: hidden; 
            background-color: #E5E5E5; 
            -webkit-box-shadow: inset 0px 0px 82px 19px rgba(0,0,0,0.3); 
            -moz-box-shadow: inset 0px 0px 82px 19px rgba(0,0,0,0.3); 
            box-shadow: inset 0px 0px 82px 19px rgba(0,0,0,0.3);
        }
        
        @keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
        @-moz-keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
        @-webkit-keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
        @-ms-keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
        @-o-keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
        
        @keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
        @-moz-keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
        @-webkit-keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
        @-ms-keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
        @-o-keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
        
        #loadingOverlay.fadeOut {
            -webkit-animation: fadeout 1.1s;
            -moz-animation: fadeout 1.1s;
            -ms-animation: fadeout 1.1s;
            -o-animation: fadeout 1.1s;
            animation: fadeout 1.1s;
            -webkit-animation-fill-mode:forwards;
            -moz-animation-fill-mode:forwards;
            animation-fill-mode:forwards;
        }
        
        #loadingIndicator {
            position: fixed;
            top: 50%;
            left: 50%;
            z-index: 1101;
        }
        
        .loadingIndicator {
            margin-left: -17px;
            margin-top: -20px;
        }


        /* CUSTOM CSS RULES */
        .width {
            width:220px!important;
        }
        #wb-body-sec #wb-main, #wb-body-sec-sup #wb-main, #wb-body-sec #wb-main-in, #wb-body-sec-sup #wb-main-in, #wb-body #gcwu-content, #wb-core-in, #gcwu-gcnb-in, #gcwu-bnr-in, #gcwu-psnb-in, #gcwu-bc-in, #gcwu-gcft-in, #gcwu-sft-in, #gcwu-psnb .mb-menu, #wb-body #wb-main {
            width: 97%;
        }

        body {
          overflow:scroll; 
        }

        .legend table th, table td {
            border-style: none;
            border-width: 0;
            padding: 0;
            vertical-align: default;
        }
        
        .skiptomain {
            position:absolute;
            color: rgba(255,255,255,0);
            background-color: rgba(0,0,0,0);
            overflow: hidden; 
            clip: rect(0 0 0 0); 
            height: 1px;
            width: 1px; 
            margin: -1px; 
            padding: 0; 
            border: 0;
            text-align: left;
            z-index: 100;
        }
        
        div.skiptomain:active, 
        div.skiptomain:focus, 
        div.skiptomain:hover {
            color: rgba(255,255,255,1);
            background-color: rgba(0,0,0,1);
            overflow: visible; 
            clip: auto; 
            height: 30px;
            width: auto; 
            margin: 5px; 
            padding: 5px;
            border: auto;
        }
        div.skiptomain a, div.skiptomain a:link {
            color: #fff;
        }
        .navDotsInner {
            background-color: #bbb;
        }
        .esriAttributionList {
            color: #000;
            background-color: rgba(255,255,255,1);
        }
        .titleBtn {
            color: #000;
        }
        .navDots .navDotsNav {
            opacity: 1.0;
            text-shadow:
            -1px -1px 0 #000,
            1px -1px 0 #000,
            -1px 1px 0 #000,
            1px 1px 0 #000;  
        }
        .dot.active {
            text-shadow:
            -1px -1px 0 #000,
            1px -1px 0 #000,
            -1px 1px 0 #000,
            1px 1px 0 #000;  
        }
        h1.floatingTitle {
            background-color: transparent;
            border: 0px solid transparent !important;
            color: #000;
            font-family: "open_sanssemibold",â€‹sans-serif !important;
            font-size: 0.8em;
            font-weight: 400 !important;
        }
        h2 {
            color: #000;
            font-size: 0.8em;
        }
        h3 {
            color: #000;
            font-size: 1em;
        }
    </style>
    </head>
    <body class="claro">
        <!-- Builder top panel is injected here -->
        <div id="builderPanel" class="hide mainViewAboveMap"></div>
        
        <!-- Content -->
        <div id="contentPanel" class="mobileView">
            <table class="containerPanelInner">
                <tr>
                    <!-- Text panel of the Side Panel layout -->
                    <td id="sidePanel">
                        <div id="sidePanelInner" class="mainViewSideMap sidePanel sectionPanel">
                            <div class="navDots vertical">
                                <!-- navigation dots -->
                            </div>
                            <div class="header" aria-hidden="true">
                                <div class="linkSocialContainer">
                                    <span class="linkContainer"></span>
                                    <span class="shareBtns">
                                        <i class="shareIcon blackHover share_facebook icon-facebook-squared" title="Share on Facebook" tabindex="-1"></i>
                                        <i class="shareIcon blackHover share_twitter icon-twitter" title="Share on Twitter" tabindex="-1"></i>
                                        <i class="shareIcon blackHover share_bitly icon-link" title="Share a short link" tabindex="-1"></i>
                                        <button type="button" class="switchBuilder btn btn-xs btn-primary" tabindex="-1"></button>
                                    </span>
                                </div>
                                <table class="logoContainer">
                                    <tr>
                                        <td class="logoWrapper">
                                            <a class="logoLink" target="_blank" tabindex="-1">
                                                <img class="logoImg"/>
                                            </a>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="appTitle" tabindex="-1" aria-hidden="true"></div>
                            <div class="separator"></div>
                            <div class="sectionsWrapper">
                                <div class="panelEditBtn">
                                    <div class="panelEditBtnInner"></div>
                                </div>
                                <div class="sections">
                                    <!-- sections injected here -->
                                </div>
                            </div>
                            <div class="builder builder-content-panel">
                                <div class="builder-content-panel-group builder-add">
                                    <div class="builder-btn"></div>
                                    <div class="builder-lbl"></div>
                                </div>
                                <div class="builder-content-panel-group builder-organize">
                                    <div class="builder-btn"></div>
                                    <div class="builder-lbl"></div>
                                </div>
                            </div>
                            <!-- <div class="resizer"></div> -->
                            <div class="scroll">
                                <div class="scrollInner" data-toggle="tooltip"></div>
                            </div>
                            <div class="builder-mask"></div>
                            <div class="firstAddExplain"></div>
                        </div>
                    </td>
                    <!-- Map -->
                    <td id="mainStagePanel">
                        <div id="mainStagePanelInner">
                            <div class="medias">
                                <!-- Maps and media injected here -->
                            </div>
                            <div id="mainStageLoadingIndicator" class="loadingIndicator">
                                <img src="resources/tpl/viewer/icons/loading-light.gif" />
                            </div>
                            <!-- Back button -->
                            <div class="mediaBackContainer">
                                <div class="backButton">
                                    <div class="backArrow"></div>
                                    <span class="backLbl"></span>
                                </div>
                            </div>
                            <!-- Builder -->
                            <div id="builderQuotes" class="centerAlignOnFloat"></div>
                            <div id="builderLanding" class="centerAlignOnFloat"></div>
                            <div id="builderHelp" class="centerAlignOnFloat"></div>
                            <div class="firstAddExplain"></div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <!-- /Content -->
        
        <div id="floatingPanel" class="floatingPanel sectionPanel">
            <div class="backdrop"></div>
            <div class="header" aria-hidden="true">
                <div class="linkSocialContainer">
                    <span class="linkContainer"></span>
                    <span class="shareBtns">
                        <i class="shareIcon blackHover share_facebook icon-facebook-squared" title="Share on Facebook" tabindex="-1"></i>
                        <i class="shareIcon blackHover share_twitter icon-twitter" title="Share on Twitter" tabindex="-1"></i>
                        <i class="shareIcon blackHover share_bitly icon-link" title="Share a short link" tabindex="-1"></i>
                        <button type="button" class="switchBuilder btn btn-xs btn-primary" tabindex="-1"></button>
                    </span>
                </div>
                <table class="logoContainer">
                    <tr>
                        <td class="logoWrapper">
                            <a class="logoLink" target="_blank" tabindex="-1">
                                <img class="logoImg"/>
                            </a>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="appTitle" tabindex="-1" aria-hidden="true"></div>
            <div class="separator"></div>
            <div class="panelEditBtn">
                <div class="panelEditBtnInner"></div>
            </div>
            <div class="sections">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <!-- sections injected here -->
                    </div>
                </div>
            </div>
            <div class="builder builder-content-panel">
                <div class="builder-content-panel-group builder-add">
                    <div class="builder-btn"></div>
                    <div class="builder-lbl"></div>
                </div>
                <div class="builder-content-panel-group builder-organize">
                    <div class="builder-btn"></div>
                    <div class="builder-lbl"></div>
                </div>
            </div>
            <div class="navDots vertical">
                <!-- navigation dots -->
            </div>
            <div class="scroll">
                <div class="scrollInner" data-toggle="tooltip"></div>
            </div>
            <div class="builder-mask"></div>
            <div class="firstAddExplain"></div>
        </div>
        
        <!-- Mobile -->
        <div id="mobileView" class="floatingSwiper">
            <div class="swiper-container">
                <div class="backdrop"></div>
                <div class="embed-btn-container embed-btn-left">
                    <div class="embed-btn"></div>
                </div>
                <div class="swiper-wrapper">
                    <!-- sections injected here -->
                </div>
                <div class="embed-btn-container embed-btn-right">
                    <div class="embed-btn"></div>
                </div>
            </div>
            <div class="header">
                <div class="backdrop"></div>
                <div class="linkSocialContainer">
                    <span class="linkContainer"></span>
                    <span class="shareBtns">
                        <i class="shareIcon share_facebook icon-facebook-squared"></i>
                        <i class="shareIcon share_twitter icon-twitter"></i>
                        <i class="shareIcon share_bitly icon-link"></i>
                    </span>
                </div>
            </div>
        </div>
        
        
        <div id="loadingOverlay"></div>
        <div id="loadingIndicator" class="loadingIndicator">
            <img src="resources/tpl/viewer/icons/loading-light.gif" />
        </div>
        <div id="loadingMessage"></div>
        
        <!-- Share dialog -->
        <div class="modal fade shareDialog" id="shareDialog" role="dialog" data-backdrop="static" tabindex="-1"></div>
        
        <!-- Builder views are injected here -->
        <div id="builder-views"></div>
        
        <!-- Fatal error box -->
        <div id="fatalError">
            <table border="0">
                <tr>
                    <td width="70px" align="center" id="fatalError-icon"></td>
                    <td id="fatalError-msg">
                        <b class="error-title"></b>
                        <p class="error-msg"></p>
                    </td>
                </tr>
            </table>
        </div>
        
        <script type="text/javascript" src="app/main-config.js"></script>
        <script type="text/javascript">
            require(["dojo/topic"], function(topic) {
                /*
                 * Custom Javascript to be executed while the application is initializing goes here
                 */
                 
                 var handleEnterKeyAsClick = function(evt) {
                    if(evt.keyCode === 13) {
                        $(this).trigger("click");
                    }
                 }
                
                // The application is ready
                topic.subscribe("tpl-ready", function(){
                    /*
                     * Custom Javascript to be executed when the application is ready goes here
                     */
                     
                     // Make each text section able to reach focus programatically
                     $("div.section").attr('tabIndex',-1);
                     
                     // Make the navigation dots keyboard accessible
                    $(".navDotsUp,.navDotsDown,.dot")
                        .attr('tabIndex',0)
                        .attr('role','button')
                        .on('keypress',function(evt) {
                            if(evt.keyCode === 13) {
                                this.click();
                                $(".section.active").focus();
                            }
                        });
                    // Make the navigation dots have proper labels
                    $(".navDotsUp,.navDotsDown,.dot").each(function() {
                        var that = $(this);
                        // If we set a title it shows up in addition to the fancy alt text
                        // So we remove the title and let 'aria-label' handle screen readers
                        that.removeAttr('title');
                        that.attr('aria-label',that.attr('data-original-title'));
                        if(that.hasClass('navDotsUp'))
                            that.attr('title',i18n.viewer.customAgs.previousButton);
                        else if(that.hasClass('navDotsDown'))
                            that.attr('title',i18n.viewer.customAgs.nextButton);
                    });
                    
                    // Add a link to the end of each section to move focus to the media container
                    $("div.section > div.content").prepend(function(index) {
                        var div = $("<div>", {id: "sideC-"+index, class: "skiptomain"});
                        var anchorToMain = $("<a>", {href: "#mainC-"+index, tabindex:-1, text:i18n.viewer.customAgs.moveToDiv});
                        div.append(anchorToMain);
                        return div;
                    });
                    $("div.content > div.skiptomain").attr('tabIndex',0).on('keypress',function(evt) {
                        if(evt.keyCode === 13) {
                            $(".mainMediaContainer.active div.skiptomain").focus();
                        }
                    });

                    // Add a link to the beginning of each media container to move focus back to it's section
                    $("div.mainMediaContainer").prepend(function(index) {
                        var div = $("<div>", {id: "mainC-"+index, class: "skiptomain"});
                        var anchorToSide = $("<a>", {href: "#sideC-"+index, tabindex:-1, text:i18n.viewer.customAgs.moveBackDiv});
                        div.append(anchorToSide);
                        return div;
                    });
                    $("div.mainMediaContainer > div.skiptomain").attr('tabIndex',0).on('keypress', function(evt) {
                        if(evt.keyCode === 13) {
                            $(".section.active").focus();
                        } else if(evt.shiftKey && evt.keyCode === 9) {
                            // If they shift tab while on this element, move back as if they clicked it
                            // Return false to consume the tab keypress 
                            $(".section.active").focus();
                            return false;
                        }
                    });

                    // Remove the blue 'Down' arrow 
                    $(".scrollInner").remove();

                    // <p>,<ul>,<ol>,<h3> elements are given a tabindex by ESRI's code.  They shouldnt.
                    $("div.content p,div.content ul,div.content ol,div.content h3").removeAttr('tabindex');

                    // Titles for each section should be a <h2> for screen readers
                    $("div.title").each(function() {
                        this.innerHTML = "<h2>" + this.textContent + "</h2>";
                    });

                    // The floating title needs to be a <h1> for screen readers
                    $("div.appTitle").each(function() {
                        this.innerHTML = "<h1 class='floatingTitle'>" + this.textContent + "</h1>";
                    });

                    // Remove the mobile version of the site
                    // Screen readers can see it and will read out 
                    $("#mobileView").attr('aria-hidden','true');
                    $("#mobileView").attr('hidden','hidden');
                });


                // This event fires after a map is loaded in the media panel
                topic.subscribe("story-loaded-map", function(result){
                    
                    // Make the zoom out/zoom in/home buttons keyboard accessible
                    // Note that selecting .esriSimpleSliderIncrementButton selects Zoom in AND Home
                    $(".esriSimpleSliderIncrementButton, .esriSimpleSliderDecrementButton")
                        .attr('tabindex',0)
                        .on('keypress',handleEnterKeyAsClick)
                        .attr('role','button');
                    $(".esriSimpleSliderIncrementButton:has(div)").attr('title',i18n.viewer.customAgs.homeButton);

                    // The above doesn't work in IE10 on specifically the +/- buttons.  So write the function by hand
                    $(".esriSimpleSliderIncrementButton").has('span').on('keypress', function() {
                        app.map.setZoom(app.map.getZoom()+1);
                    });
                    $(".esriSimpleSliderDecrementButton").has('span').on('keypress', function() {
                        app.map.setZoom(app.map.getZoom()-1);
                    });

                    // Make the close keys on windows keyboard accessible
                    $(".close")
                        .attr('tabindex',0)
                        .attr('role','button')
                        .attr('title',i18n.viewer.common.close)
                        .on('keypress',handleEnterKeyAsClick);

                    // Make the expand/contract icons on windows keyboard accessible
                    $(".glyphicon-chevron-up, .glyphicon-chevron-down")
                        .attr('tabindex',0)
                        .attr('role','button')
                        .attr('title',i18n.viewer.customAgs.toggleChevron)
                        .on('keypress',handleEnterKeyAsClick);

                    // Loading indicator needs alt text
                    $(".loadingIndicator img").attr('alt',i18n.viewer.loading.step1);

                    // Some images and icons get added without alt tags
                    // This should fix them
                    var updateLayerImagesWithAltTags = function() {
                        $("image:not([alt])").attr('alt','');
                        $("img:not([alt])").attr('alt','');
                        console.log('updating alt tags');
                    }
                    // Run this once now, then again whenever the map loads
                    // This catches things like if you pan into new icons/images
                    updateLayerImagesWithAltTags();
                    app.map.on('update-end',updateLayerImagesWithAltTags);

                    // Remove images that have no 'src' - logoImg
                    $("img.logoImg").remove();
                    
                    // Set up keyboard navigation for the map
                    $(".active .mapContainer.map").attr('tabindex',0).on('keydown', function(evt) {

                        // We only want to capture events on the map itself, not
                        // any of the map's children.
                        if(evt.target.classList.contains('mapContainer') === false) {
                            return;
                        }

                        // shorthand for less typing
                        var k = dojo.keys;
                        switch(evt.keyCode) {
                            // Handle up key
                            case k.UP_ARROW:
                            case k.NUMPAD_8:
                                evt.preventDefault();
                                app.map.panUp();
                                break;
                            // Handle down key
                            case k.DOWN_ARROW:
                            case k.NUMPAD_2:
                                evt.preventDefault();
                                app.map.panDown();
                                break;
                            // Handle left key
                            case k.LEFT_ARROW:
                            case k.NUMPAD_4:
                                evt.preventDefault();
                                app.map.panLeft();
                                break;
                            // Handle right key
                            case k.RIGHT_ARROW:
                            case k.NUMPAD_6:
                                evt.preventDefault();
                                app.map.panRight();
                                break;
                            // Handle zoom in key
                            case k.NUMPAD_PLUS:
                            case 187: // equals
                            case 61:  // equals on firefox
                                evt.preventDefault();
                                app.map.setZoom(app.map.getZoom()+1);
                                break;
                            // Handle zoom out key
                            case k.NUMPAD_MINUS:
                            case 189: // minus
                            case 173: // minus on firefox
                                evt.preventDefault();
                                app.map.setZoom(app.map.getZoom()-1);
                                break;
                            default:
                                // nothing to do - let the event propagate
                        }
                    });


                    if ( result.index !== null )
                      console.log("The map", result.id, "has been loaded from the section", result.index);
                    else
                      console.log("The map", result.id, "has been loaded from a Main Stage Action");
                });
                
            });
        </script>
    </body>
</html>
